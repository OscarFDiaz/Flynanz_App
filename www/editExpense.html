<ons-page id="editExpense">
  <ons-toolbar id="toolbar" class="toolbar" modifier="transparent">
    <div class="left">
      <ons-back-button onclick="hideAlertExpenseEditNoChange()"></ons-back-button>
    </div>
    <div class="center labelToolbar" id="titleExpensesEdit">EDITAR GASTO</div>
  </ons-toolbar>

  <ons-card>
    <div class="content">
      <div style="text-align: center; margin-top: 16px">
        <div>
          <p style="margin: 0px auto -16px 12px; text-align: left; padding-top: 16px" id="editExpenseName">NOMBRE DEL GASTO</p>
          <ons-input
            onchange="changeTitlePreviewEdit()"
            onkeypress="this.onchange()"
            oninput="this.onchange()"
            id="newExpenseNameEdit"
            modifier="underbar"
            placeholder=""
            type="text"
            style="display: block; margin: 0px auto 16px auto"
          ></ons-input>
        </div>
      </div>

      <div>
        <p style="margin: 0px auto -16px 12px; text-align: left" id="editExpenseColor">SELECCIONA UN COLOR</p>
        <div style="margin-top: 16px; border: 2px solid var(--color-input); border-radius: 15px; height: 48px">
          <div class="input-color-container" style="width: 100%; height: 44px; border: none">
            <input
              onchange="loadIconsEdit()"
              onkeypress="this.onchange()"
              oninput="this.onchange()"
              class="customInput"
              value="#ffffff"
              type="color"
              id="newExpenseColorEdit"
              style="display: block; width: 105%; height: 150%; margin: 0px"
            />
          </div>
        </div>
      </div>

      <p style="margin: 16px auto 0px 12px; text-align: left; color: var(--card-content-text-color)" id="editExpenseIcon">
        SELECCIONA UN ICONO
      </p>
      <div style="border: 2px solid var(--color-input); border-radius: 15px; margin-bottom: 16px">
        <ons-list style="background: none; margin-top: -16px">
          <ons-list-item id="expandableListContainerEdit" expandable>
            <p
              style="margin: 0px auto 0px 12px; text-align: left; color: var(--card-content-text-color)"
              id="editExpenseIconLabel"
            >
              CLICK PARA CAMBIAR
            </p>
            <div class="expandable-content" id="expenseIconListOfIconsEdit">
              <!-- AQUI SE CARGAN LOS ICONOS PARA SELECCIONAR -->
            </div>
          </ons-list-item>
        </ons-list>
      </div>

      <div>
        <p style="margin: 0px auto -16px 12px; text-align: left" id="editExpenseSwitch">MOSTRAR EN INICIO</p>
        <div style="margin-top: 16px; border: 2px solid var(--color-input); border-radius: 15px; height: 48px">
          <div style="text-align: left; display: block; margin: 10px 16px">
            <ons-switch id="switchNewGoalEdit"></ons-switch>
          </div>
        </div>
      </div>

      <ons-button
        class="flatButton"
        style="margin-top: 16px; margin-left: 0px; margin-right: 0px"
        onclick="hideAlertExpenseEdit()"
        id="editExpenseFinishedButton"
        >LISTO!</ons-button
      >
      <ons-button
        class="flatButtonLight"
        style="margin-top: 16px; margin-left: 0px; margin-right: 0px"
        onclick="hideAlertExpenseEditNoChange()"
        id="editExpenseCancelButton"
        >CANCELAR</ons-button
      >
    </div>
  </ons-card>

  <label class="cardHomeTitle" id="editExpensePrevTitle">PREVISUALIZACIÓN</label>
  <ons-card>
    <div class="title expenseTitle" id="expensePrevTitleEdit" style="display: inline-block; margin-bottom: 16px">
      NUEVO NOMBRE
    </div>
    <i class="expenseIcon" id="expensePrevIconEdit"></i>
    <div class="content" style="margin-top: -16px">
      <label class="expenseInfo" id="expenseInfoInsert">$ GASTADOS TOTALMENTE</label>
    </div>
    <ons-button class="moneyButtonAdd" style="margin-bottom: 16px" onclick="" id="editExpensePrevAddButton">
      AÑADIR GASTO
    </ons-button>
    <ons-button class="moneyButtonDe" style="margin-bottom: 16px" onclick="" id="editExpensePrevAddButton"> ELIMINAR </ons-button>
  </ons-card>

  <script>
    document.addEventListener(
      'init',
      function (event) {
        if (event.target.matches('#editExpense')) {
          ons.ready(function () {
            let languaje = localStorage.getItem('storageSwitchLanguage');
            if (languaje == 'false') {
              document.getElementById('titleExpensesEdit').innerHTML = 'Edit expenditure';
              document.getElementById('editExpenseName').innerHTML = 'Name of expenditure';
              document.getElementById('editExpenseColor').innerHTML = 'Select a color';
              document.getElementById('editExpenseIcon').innerHTML = 'Select an icon';
              document.getElementById('editExpenseIconLabel').innerHTML = 'Click to change';
              document.getElementById('editExpenseSwitch').innerHTML = 'Show in home';
              document.getElementById('editExpenseFinishedButton').innerHTML = 'Finished!';
              document.getElementById('editExpenseCancelButton').innerHTML = 'Cancel';

              document.getElementById('editExpensePrevTitle').innerHTML = 'Preview';
              document.getElementById('expensePrevTitleEdit').innerHTML = 'New name';
              document.getElementById('expenseInfoInsert').innerHTML = '$ totally spent';
              document.getElementById('editExpensePrevAddButton').innerHTML = ' Add expense ';
              document.getElementById('editExpensePrevAddButton').innerHTML = ' Delete ';
            } else {
              document.getElementById('titleExpensesEdit').innerHTML = 'Editar gasto';
              document.getElementById('editExpenseName').innerHTML = 'Nombre del gasto';
              document.getElementById('editExpenseColor').innerHTML = 'Selecciona un color';
              document.getElementById('editExpenseIcon').innerHTML = 'Selecciona un icono';
              document.getElementById('editExpenseIconLabel').innerHTML = 'Click para cambiar';
              document.getElementById('editExpenseSwitch').innerHTML = 'Mostrar en inicio';
              document.getElementById('editExpenseFinishedButton').innerHTML = 'Listo!';
              document.getElementById('editExpenseCancelButton').innerHTML = 'Cancelar';

              document.getElementById('editExpensePrevTitle').innerHTML = 'Previsualización';
              document.getElementById('expensePrevTitleEdit').innerHTML = 'Nuevo nombre';
              document.getElementById('expenseInfoInsert').innerHTML = '$ gastados totalmente';
              document.getElementById('editExpensePrevAddButton').innerHTML = ' Añadir gasto ';
              document.getElementById('editExpensePrevAddButton').innerHTML = ' Eliminar ';
            }

            loadIconsEdit();

            let expenseNameEdit = sessionStorage.getItem('expenseNameEdit');
            document.getElementById('newExpenseNameEdit').value = expenseNameEdit;
            document.getElementById('expensePrevTitleEdit').innerHTML = expenseNameEdit;

            let expenseS = JSON.parse(localStorage.getItem('expenseStorage'));
            let expenseIcon, expenseColor, isChecked;
            let expenseInfoInsert = document.getElementById('expenseInfoInsert');

            for (let i = 0; i < expenseS.length; i++) {
              if (expenseS[i].expenseName == expenseNameEdit) {
                expenseIcon = expenseS[i].iconName;
                expenseColor = expenseS[i].expenseColor;

                if (languaje == 'false') {
                  expenseInfoInsert.innerHTML = '$ ' + expenseS[i].totalExpense + ' spent';
                } else {
                  expenseInfoInsert.innerHTML = '$ ' + expenseS[i].totalExpense + ' gastados';
                }
                //Seteo el switch
                isChecked = expenseS[i].toShow;
                break;
              }
            }

            if (isChecked) {
              document.getElementById('switchNewGoalEdit').setAttribute('checked', true);
            } else {
              document.getElementById('switchNewGoalEdit').removeAttribute('checked');
            }

            document.getElementById('newExpenseColorEdit').value = expenseColor;

            /* OBTENGO EL ICONO ACTUAL Y LO AÑADO*/
            let iconElement = document.getElementById('expensePrevIconEdit');
            sessionStorage.setItem('oldIcon', expenseIcon);
            iconElement.className = '';
            iconElement.classList.add('expenseIcon');
            iconElement.classList.add(expenseIcon);
            // Añado el color
            iconElement.style.cssText = `--expenseIconColorPrev: ${expenseColor}`;
          });
        }
      },
      false
    );
  </script>
</ons-page>
